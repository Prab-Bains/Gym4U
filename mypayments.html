<!doctype html>
<html lang="en">

<head>
    <link href="/images/logo_without_text.png" rel="icon" type="image/x-icon" />
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- Our Own CSS-->
    <link rel="stylesheet" type="text/css" href="./styles/my_style.css">

    <!-- Firebase 8 CDNs-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
        </script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>

    <!-- Link to the api keys for your firebase project -->
    <script src="./scripts/firebaseAPI_DTC11.js"></script>

    <!-- Our own JS files-->
    <script src="./scripts/sidebarmenu.js"></script>

    <title>Gym4U</title>
</head>


<body>
    <!-- navbar-light bg-secondary -->
    <nav id="top_nav" class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a href="main.html"><img src="./images/logo_without_text.png" class="img-fluid" alt="logo"
                    style="width: 50px; height: 50px;"></a>

            <button class="btn btn-secondary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight"
                aria-controls="offcanvasRight">&#9776;</button>

            <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight"
                aria-labelledby="offcanvasRightLabel">
                <div class="offcanvas-header">
                    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"
                        aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <div class="card">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item"><a href="profile.html">Profile</a></li>
                            <li class="list-group-item"><a href="listings.html">Listings</a></li>
                            <li class="list-group-item"><a href="appointments.html">Appointments</a></li>
                            <li class="list-group-item"><a href="help.html">Help</a></li>
                            <li class="list-group-item"><a id="signout">Sign Out</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <button class="openBtn">Add Credit Card</button>
    <button class="btn" onClick="readCreditCardList()">Refresh</button>

    <div class="credit_container" style="text-align: center;">
    </div>


    <div class="modal hidden">
        <div class="bg"></div>
        <div class="modalBox">
            <div class="px-4 py-5 my-5 text-center">
                <label for="floatingSelect">Gym list.</label>
                <select id="cardtype_id" aria-label="Floating label select example">
                    <option selected>Credit Card Type</option>
                    <option value="Visa">Visa</option>
                    <option value="MasterCard">MasterCard</option>
                    <option value="American Express">American Express</option>
                </select>
                <label for="creditcardno">Credit Card Number:</label>
                <input id="creditcardno_id" type="tel" inputmode="numeric" pattern="[0-9\s]{13,19}"
                    autocomplete="cc-number" maxlength="16" placeholder="xxxx xxxx xxxx xxxx" name="creditcardno"
                    required><br>
                <label for="cardname">Name on Card:</label>
                <input type="text" id="cardname_id" placeholder="Enter full name on card" name="cardname" required><br>
                <label for="expiry">Expiry Date:</label>
                <input type="date" id="expiry_id" name="expiry" required><br>
                <label for="cvv">CVV:</label>
                <input type="password" id="cvv_id" placeholder="cvv number" inputmode="numeric" pattern="[0-9]"
                    maxlength="3" name="cvv" required>
                <label for="billing">Billing Address:</label>
                <input type="text" id="billing_id" placeholder="Enter your billing address" width="100px" name="billing"
                    required>
                <button type="button" class="btn btn-lg px-4 gap-3" onClick="addCreditCard()">Save Card</button>
                <button class="closeBtn">âœ–</button>
            </div>
        </div>
    </div>

    <footer id="bottom_nav">
        <div>
            &#169; Gym4U
        </div>
    </footer>



    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">

        </script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    -->

    <script>

        function removeCreditCard(id) {
            firebase.auth().onAuthStateChanged(user => {
                if (user) {
                    var uid = user.uid
                    var currentDB = db.collection("creditcards").doc(uid)
                    var creditCardtype = "cardtype_id" + id.slice(-1)
                    var creditCardNo = "creditcardno_id" + id.slice(-1)
                    var cardName = "cardname_id" + id.slice(-1)
                    var expiry = "expiry_id" + id.slice(-1)
                    var CVV = "cvv_id" + id.slice(-1)
                    var billing = "billing_id" + id.slice(-1)

                    var creditcardtype_value = $("#" + creditcardtype_id).text();
                    var creditcardno_value = $("#" + creditcardno_id).text();
                    var cardname_value = $("#" + cardname_id).text();
                    var expiry_value = $("#" + expiry_id).text();
                    var cvv_value = $("#" + cvv_id).text();
                    var billing_value = $("#" + billing_id).text();


                    let creditcard_info_object = new Object({
                        creditcardtype: creditcardtype_value,
                        creditcardno: creditcardno_value,
                        cardname: cardname_value,
                        expiry: expiry_value,
                        cvv: cvv_value,
                        billing: billing_value
                    });

                    currentDB.update({
                        creditcard_list: firebase.firestore.FieldValue.arrayRemove(creditcard_info_object)
                    })
                    alert("Succesfully, removed credit card.")
                }
            })
        }


        function addCreditcard() {
            firebase.auth().onAuthStateChanged(user => {
                if (user) {
                    var uid = user.uid
                    var currentDB = db.collection("creditcards").doc(uid)

                    let cardtype = document.getElementById("cardTtype_id").value;
                    let cardno = document.getElementById("creditcardno_id").value;
                    let cardname = document.getElementById("cardname_id").value;
                    let expiry = document.getElementById("expiry_id").value;
                    let cvv = document.getElementById("cvv_id").value;
                    let billing = document.getElementById("billing_id").value;
                    let creditcard_info_object = new Object({
                        creditcardtype: creditcardtype_value,
                        creditcardno: creditcardno_value,
                        cardname: cardname_value,
                        expiry: expiry_value,
                        cvv: cvv_value,
                        billing: billing_value
                    });
                    console.log(uid);
                    // console.log(gymname);
                    // console.log(from_time);
                    // console.log(to_time);
                    // console.log(date);
                    // console.log(appointment_info_object);

                    currentDB.update({
                        creditcard_list: firebase.firestore.FieldValue.arrayUnion(credit_info_object)
                    })
                    alert("Succesfully, added credit card.")
                } else {
                    alert("no user signed-in");
                }
            })
        }


        function readAppointmentList() {
            $(".credit_card_container").empty();
            firebase.auth().onAuthStateChanged(user => {
                if (user) {
                    var uid = user.uid
                    console.log(uid);
                    var currentDB = db.collection("creditcards").doc(uid)
                    currentDB.get()
                        .then(appointmentListdoc => {
                            var list = appointmentListdoc.data().appointment_list
                            console.log(list);
                            for (let i = list.length - 1; i > -1; i--) {
                                cardType = list[i]["cardType"];
                                expiry = list[i]["expiry"];


                                var containerform =
                                    `<div class="card text-white bg-secondary mb-3" style="max-width: 18rem;">
                                    <div class="card-header" id="cardtype_id_${i}">${cardtype}</div>
                                        <div class="card-body">
                                            <h5 class="card-title">Expiry : </h5><h5 id="expiry_id_${i}">${expiry}</h5></h5>
                                            <button id="deleteButton_${i}" onclick="removeCreditCard(this.id)">Remove this Credit Card</button>
                                        </div>
                                    </div>`;
                                $(".credit_card_container").append(containerform);
                            }
                        })

                } else {
                    alert("no user signed-in");
                }
            })
        }
        readAppointmentList();

        const open = () => {
            document.querySelector(".modal").classList.remove("hidden");
        }
        const close = () => {
            document.querySelector(".modal").classList.add("hidden");
            readAppointmentList();
        }

        document.querySelector(".openBtn").addEventListener("click", open);
        document.querySelector(".closeBtn").addEventListener("click", close);
        document.querySelector(".bg").addEventListener("click", close);


        // listener for the signout link
        document.getElementById("signout").addEventListener("click", logout);

    </script>

</body>

</html>